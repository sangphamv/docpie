---
// Table of Contents component - uses Astro's getHeadings() for optimal performance
import { CONSTANTS } from "@/lib/config";

type Props = {
  headings?: Array<{ depth: number; slug: string; text: string }>;
};

const { headings = [] } = Astro.props;

// Filter to only h2 and h3
const toc = headings.filter((heading) => heading.depth <= 3);
---

<div class="card bg-base-200 shadow-sm mb-6">
  <div class="card-body p-4">
    <details class="group" aria-label={CONSTANTS.Table_Of_Contents}>
      <summary class="flex items-center justify-between text-sm uppercase tracking-wider opacity-80 cursor-pointer select-none">
        <span>{CONSTANTS.Table_Of_Contents}</span>
        <span class="transition-transform duration-200 group-open:rotate-180">âŒ„</span>
      </summary>

      {toc.length > 0 ? (
        <nav class="text-sm mt-3 max-h-72 overflow-auto pr-1">
          <ul class="space-y-1">
            {toc.map((item) => (
              <li>
                <a
                  href={`#${item.slug}`}
                  class={`block text-base-content/80 hover:text-[color:var(--accent)] py-1 transition-colors ${
                    item.depth === 3 ? "pl-5 text-xs" : ""
                  }`}
                >
                  {item.text}
                </a>
              </li>
            ))}
          </ul>
        </nav>
      ) : (
        <p class="text-sm text-base-content/60 mt-3">No headings found</p>
      )}
    </details>
  </div>
</div>