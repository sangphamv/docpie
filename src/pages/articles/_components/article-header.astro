---
import { Image, Picture } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import { formatDate, normalizeDate } from "@/lib/utils/date";
import ResourcesAdd from "@/assets/svgs/resources-add.astro";
import Time04 from "@/assets/svgs/time-04.astro";
import Calendar04 from "@/assets/svgs/calendar-04.astro";
import Divider from "@/components/bases/divider.astro";
import { categoriesHandler } from "@/lib/handlers/categories";
import { authorsHandler } from "@/lib/handlers/authors";

type Props = {
  article: CollectionEntry<"articles">;
  readingTime: string;
};

const { article, readingTime } = Astro.props;

const category = categoriesHandler.oneCategory(article.data.category.id);
const authors = authorsHandler.getAuthors(article.data.authors);
---

<section class="mb-0 py-6">
  <div class="container max-w-5xl">
    <!-- Category -->
    <div class="mb-4">
      <a 
        href={`/categories/${category.id}`} 
        class="text-sm font-bold uppercase tracking-wider text-primary dark:text-secondary hover:underline"
      >
        {category.data.title}
      </a>
    </div>

    <!-- Title -->
    <h1 class="text-3xl lg:text-5xl font-bold text-left leading-tight mb-4">
      {article.data.title}
    </h1>

    <!-- Description -->
    {article.data.description && (
      <p class="text-lg text-base-content/80 mb-6 leading-relaxed">
        {article.data.description}
      </p>
    )}

    <!-- Meta Info -->
    <div class="flex flex-wrap items-center gap-4 text-sm text-base-content/70 pb-6 mb-6 border-b border-base-300">
      <!-- Authors -->
      <div class="flex flex-wrap gap-3">
        {
          authors.map((author) => (
            <a
              href={`/authors/${author.id}`}
              class="flex items-center gap-2 hover:text-primary dark:hover:text-secondary"
            >
              <div class="avatar">
                <div class="w-8 rounded-full">
                  <Image
                    src={author.data.avatar}
                    alt={author.data.name}
                    width={48}
                    height={48}
                    loading={"eager"}
                    format="webp"
                    layout="constrained"
                    quality={80}
                  />
                </div>
              </div>
              <span class="font-semibold">{author.data.name}</span>
            </a>
          ))
        }
      </div>

      <Divider />

      <!-- Date -->
      <span class="flex items-center gap-1">
        <Calendar04 size="15" />
        <time datetime={normalizeDate(article.data.publishedTime)}>
          {formatDate(normalizeDate(article.data.publishedTime), "long")}
        </time>
      </span>

      <Divider />

      <!-- Reading Time -->
      <span class="flex items-center gap-1">
        <Time04 size="15" />
        <span>{readingTime}</span>
      </span>
    </div>

    <!-- Featured Image -->
    <div class="overflow-hidden rounded-lg mb-6">
      <Picture
        src={article.data.cover}
        alt={article.data.covert_alt || article.data.title}
        layout="constrained"
        loading={"eager"}
        formats={["avif", "webp"]}
        class="w-full h-auto object-center"
      />
    </div>
  </div>
</section>

