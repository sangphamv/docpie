---
import { articlesHandler } from "@/lib/handlers/articles";
import { render } from "astro:content";
import { CONSTANTS } from "@/lib/config";

const trendingArticles = articlesHandler.allArticles().slice(0, 4);
---

<aside class="sticky top-4">
  <h2 class="text-sm font-bold uppercase tracking-wider mb-6 pb-3 border-b-2 border-base-300">
    {CONSTANTS.Latest_Stories_Published}
  </h2>
  <ul class="space-y-6">
    {
      trendingArticles.map(async (article, index) => {
        const { remarkPluginFrontmatter } = await render(article);
        return (
          <li class="group">
            <a
              href={`/articles/${article.id}`}
              class="flex items-start gap-4 transition-opacity hover:opacity-70"
            >
              <div class="flex-shrink-0 w-20 h-20 overflow-hidden rounded">
                <img
                  src={article.data.cover.src}
                  alt={article.data.covert_alt || article.data.title}
                  class="w-full h-full object-cover"
                  loading="lazy"
                />
              </div>
              <div class="flex-1 min-w-0">
                <span class="text-xs text-primary dark:text-secondary font-medium mb-1 block">
                  {index + 1}
                </span>
                <h3 class="text-sm font-medium leading-tight line-clamp-3 mb-1">
                  {article.data.title}
                </h3>
              </div>
            </a>
          </li>
        );
      })
    }
  </ul>
</aside>
