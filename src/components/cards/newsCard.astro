---
import { Image } from "astro:assets";
import Divider from "../bases/divider.astro";
import type { CollectionEntry } from "astro:content";
import { render } from "astro:content";
import { categoriesHandler } from "@/lib/handlers/categories";

type Props = {
  article: CollectionEntry<"articles">;
  index: number;
};

const { article, index } = Astro.props;

const { remarkPluginFrontmatter } = await render(article);
const category = categoriesHandler.oneCategory(article.data.category.id);
---

<article
  data-parallax-card
  class="group flex flex-col h-full relative isolate"
>
  <div class="parallax-inner flex flex-col gap-3 overflow-hidden rounded-lg bg-base-200 shadow-lg text-base-content transition-transform duration-300 h-full">
    <a href={`/articles/${article.id}`} aria-label={`Read article: ${article.data.title}`} class="block aspect-video overflow-hidden" data-skeleton>
      <Image
        src={article.data.cover}
        alt={article.data.covert_alt ? article.data.covert_alt : article.data.title}
        loading="lazy"
        layout="constrained"
        format={"avif"}
        class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-105"
      />
    </a>
    
    <div class="flex flex-col flex-1 px-3 pb-3 sm:px-4 sm:pb-4">
      <div class="flex items-center text-xs gap-2 mb-2 opacity-70">
        <span class="text-primary font-medium uppercase tracking-wide">
          {category.data.title}
        </span>
        <Divider />
        <span>{remarkPluginFrontmatter.minutesRead}</span>
      </div>
      
      <h3 class="text-lg font-semibold leading-tight mb-2 transition-colors line-clamp-2 group-hover:text-primary">
        <a href={`/articles/${article.id}`}>
          <span class="absolute inset-0 z-10 pointer-events-none"></span>
          {article.data.title}
        </a>
      </h3>
      
      <p class="text-sm opacity-70 line-clamp-2 flex-1">
        {article.data.description}
      </p>
    </div>
  </div>
</article>
