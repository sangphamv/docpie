---
import ArrowLeftDouble from "@/assets/svgs/arrow-left-double.astro";
import ArrowRightDouble from "@/assets/svgs/arrow-right-double.astro";
import ArrowLeft01 from "@/assets/svgs/arrow-left-01.astro";
import ArrowRight01 from "@/assets/svgs/arrow-right-01.astro";
import { PAGINATION } from "@/lib/config";

type Props = {
  length: number;
  currentUrl: string;
  currentPage: number;
  baseUrl: string;
  prevUrl: string | undefined;
  nextUrl: string | undefined;
  lastUrl: string;
};

const { length, currentUrl, currentPage, baseUrl, prevUrl, nextUrl, lastUrl } =
  Astro.props;

// Define the maximum number of visible buttons
const maxVisibleButtons = 4;

// Calculate the range of visible page numbers
const startPage = Math.max(1, currentPage - Math.floor(maxVisibleButtons / 2));
const endPage = Math.min(length, startPage + maxVisibleButtons - 1);

// Adjust the startPage if we're at the end of the pagination
const adjustedStartPage = Math.max(1, endPage - maxVisibleButtons + 1);

// Generate the pagination list based on the range
const paginationList = Array.from(
  { length: endPage - adjustedStartPage + 1 },
  (_, i) => adjustedStartPage + i
);
---

<section
  class:list={[
    "flex items-center justify-center mx-auto mt-12 mb-8",
    !prevUrl && !nextUrl ? "hidden" : "",
  ]}
>
  <nav class="join shadow-[var(--shadow-soft)]">
    {
      `${baseUrl}/1` == `${currentUrl}` ? (
        <span class="join-item btn btn-sm btn-disabled border border-[color:var(--border-color)] bg-[color:var(--bg-subtle)] text-[color:var(--text-muted)]" aria-label="First page">
          <ArrowLeftDouble />
        </span>
      ) : (
        <a
          href={`${baseUrl}/1`}
          class="join-item btn btn-sm border border-[color:var(--border-color)] bg-[color:var(--bg-subtle)] text-[color:var(--text-primary)] hover:bg-[color:color-mix(in_oklab,var(--primary)_8%,var(--bg-subtle)_92%)] hover:border-[color:color-mix(in_oklab,var(--primary)_25%,var(--border-color)_75%)] hover:text-[color:color-mix(in_oklab,var(--primary)_60%,var(--text-primary)_40%)]"
          aria-label="First page"
        >
          <ArrowLeftDouble />
        </a>
      )
    }

    {
      prevUrl ? (
        <a href={prevUrl} class="join-item btn btn-sm border border-[color:var(--border-color)] bg-[color:var(--bg-subtle)] text-[color:var(--text-primary)] hover:bg-[color:color-mix(in_oklab,var(--primary)_8%,var(--bg-subtle)_92%)] hover:border-[color:color-mix(in_oklab,var(--primary)_25%,var(--border-color)_75%)] hover:text-[color:color-mix(in_oklab,var(--primary)_60%,var(--text-primary)_40%)]">
          <ArrowLeft01 /> <span class="hidden lg:block">{PAGINATION.previous}</span>
        </a>
      ) : (
        <span class="join-item btn btn-sm btn-disabled border border-[color:var(--border-color)] bg-[color:var(--bg-subtle)] text-[color:var(--text-muted)]">
          <ArrowLeft01 /> <span class="hidden lg:block">{PAGINATION.previous}</span>
        </span>
      )
    }

    {
      paginationList.map((num) => (
        <a
          href={`${baseUrl}${num == 1 ? "" : "/" + num}`}
          class={`join-item btn btn-sm border border-[color:var(--border-color)] bg-[color:var(--bg-subtle)] text-[color:var(--text-primary)] hover:bg-[color:color-mix(in_oklab,var(--primary)_8%,var(--bg-subtle)_92%)] hover:border-[color:color-mix(in_oklab,var(--primary)_25%,var(--border-color)_75%)] hover:text-[color:color-mix(in_oklab,var(--primary)_60%,var(--text-primary)_40%)] ${currentPage == num ? "bg-[color:var(--primary)] border-[color:var(--primary)] text-[color:var(--primary-contrast)] pointer-events-none" : ""}`}
        >
          {num}
        </a>
      ))
    }

    {
      !nextUrl ? (
        <span class="join-item btn btn-sm btn-disabled border border-[color:var(--border-color)] bg-[color:var(--bg-subtle)] text-[color:var(--text-muted)]">
          <span class="hidden lg:block">{PAGINATION.next}</span> <ArrowRight01 />
        </span>
      ) : (
        <a href={nextUrl} class="join-item btn btn-sm border border-[color:var(--border-color)] bg-[color:var(--bg-subtle)] text-[color:var(--text-primary)] hover:bg-[color:color-mix(in_oklab,var(--primary)_8%,var(--bg-subtle)_92%)] hover:border-[color:color-mix(in_oklab,var(--primary)_25%,var(--border-color)_75%)] hover:text-[color:color-mix(in_oklab,var(--primary)_60%,var(--text-primary)_40%)]">
          <span class="hidden lg:block">{PAGINATION.next}</span> <ArrowRight01 />
        </a>
      )
    }

    {
      lastUrl == currentUrl ? (
        <span class="join-item btn btn-sm btn-disabled border border-[color:var(--border-color)] bg-[color:var(--bg-subtle)] text-[color:var(--text-muted)]" aria-label="Last page">
          <ArrowRightDouble />
        </span>
      ) : (
        <a href={lastUrl} class="join-item btn btn-sm border border-[color:var(--border-color)] bg-[color:var(--bg-subtle)] text-[color:var(--text-primary)] hover:bg-[color:color-mix(in_oklab,var(--primary)_8%,var(--bg-subtle)_92%)] hover:border-[color:color-mix(in_oklab,var(--primary)_25%,var(--border-color)_75%)] hover:text-[color:color-mix(in_oklab,var(--primary)_60%,var(--text-primary)_40%)]" aria-label="Last page">
          <ArrowRightDouble />
        </a>
      )
    }
  </nav>
</section>
